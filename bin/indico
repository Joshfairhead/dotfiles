#!/bin/bash
# Indico launcher

start_indico() {
  source $PROJECTS/indico/bin/activate
  zdaemon -C $PROJECTS/indico/src/etc/zdctl.conf start
  /opt/maildump/bin/maildump -n -p /tmp/maildump.pid --http-ip 137.138.36.201 --db /tmp/maildump.sqlite --http-port 5000
  indico_shell --web-server --reload-on-change
}

stop_indico() {
  source $PROJECTS/indico/bin/activate
  zdaemon -C $PROJECTS/indico/src/etc/zdctl.conf stop
  /opt/maildump/bin/maildump --stop -p /tmp/maildump.pid
}

run_indico_funct_tests() {
  source $PROJECTS/indico/bin/activate
  cd $PROJECTS/indico/src/

  # if [ $# -gt 0 ]; then
  #   specific="--specify="$1
  # else
  #   specific=""
  # fi

  python setup.py test --functional --browser=chrome $specific
}

run_inidico_unit_tests() {
  source $PROJECTS/indico/bin/activate
  cd $PROJECTS/indico/src/
  python setup.py test --unit
}

show_indico_logger() {
  tail -f $PROJECTS/indico/log/indico.log
}

case "$1" in
  start)
    start_indico;;
  stop)
    stop_indico;;
  testfunc)
    run_indico_funct_tests;;
  testunit)
    run_indico_unit_tests;;
  logger)
    show_indico_logger;;
  *)
    echo "usage indico {start | stop | testfunc | testunit | logger }"
    exit 1
esac
