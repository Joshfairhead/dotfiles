#!/usr/bin/env bash
# Asks for sudo and keeps it
# Usage: sudoplz [--step]

source $DOT/functions/keepsudo
source $DOT/functions/try

pprint_type='info-warn'
[[ "$1" == '--step' ]] && pprint_type='step-user'

if [[ $(sudo -n true 2>&1) ]]; then
  pprint "${pprint_type}" -n "Can I haz sudo?"
  try keepsudo -p "$(pprint text -r '.. Password: ')"
  [[ $TRY_CODE == 0 ]] && pprint text -r ".. \033[0;32mkthxbye\033[0m"
  [[ $TRY_CODE != 0 ]] && pprint text -r ".. \033[0;31mnope\033[0m"
  [[ $TRY_CODE != 0 ]] || [[ "$1" == '--step' ]] && pprint newline
fi

exit $TRY_CODE
